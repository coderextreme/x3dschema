<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE X3D
  PUBLIC "ISO//Web3D//DTD X3D 3.3//EN" "https://www.web3d.org/specifications/x3d-3.3.dtd">
<X3D xmlns:xsd="http://www.w3.org/2001/XMLSchema-instance"
      profile="Immersive"
      version="3.3"
      xsd:noNamespaceSchemaLocation="https://www.web3d.org/specifications/x3d-3.3.xsd">
   <head>
      <meta content="arc3.x3d" name="title"/>
      <meta content="Lost, Doug Sanden I think" name="creator"/>
      <meta content="manual" name="generator"/>
      <meta content="https://coderextreme.net/X3DJSONLD/src/main/data/x3dconnectorProto.x3d"
             name="identifier"/>
      <meta content="a generic proto to connect two objects" name="description"/>
   </head>
   <Scene>
      <Viewpoint description="Only Viewpoint" position="0 0 5"/>
      <Background skyColor="0.4 0.4 0.4"/>
      <Transform DEF="DECLpoint_G1_node">
         <Shape>
            <Sphere containerField="geometry" radius="0.1"/>
            <Appearance>
               <Material diffuseColor="1 0 0"/>
            </Appearance>
         </Shape>
         <PositionInterpolator DEF="DECLpoint_G1_PI1" key="0 1" keyValue="0 0 0 0 5 0"/>
         <Script DEF="DECLpoint_G1_MB1">
            <field accessType="inputOutput"
                    name="translation"
                    type="SFVec3f"
                    value="0 0 0"/>
            <field accessType="inputOutput"
                    name="old"
                    type="SFVec3f"
                    value="0 0 0"/>
            <field accessType="inputOnly" name="set_location" type="SFTime"/>
            <field accessType="inputOutput"
                    name="keyValue"
                    type="MFVec3f"
                    value="0 0 0 0 5 0"/>""&#xD;
"ecmascript:"&#xD;
"\t\tfunction set_location(value) {"&#xD;
"                    old = translation;"&#xD;
"\t\t    translation = new SFVec3f(Math.random()*10-5, Math.random()*10-5, Math.random()*10-5);"&#xD;
"                    keyValue = new MFVec3f([old, translation]);"&#xD;
"\t\t    // Browser.println(keyValue);"&#xD;
"\t\t}"&#xD;
""</Script>
         <TimeSensor DEF="DECLpoint_G1_CL1" cycleInterval="3" loop="true"/>
         <ROUTE fromField="cycleTime"
                 fromNode="DECLpoint_G1_CL1"
                 toField="set_location"
                 toNode="DECLpoint_G1_MB1"/>
         <ROUTE fromField="fraction_changed"
                 fromNode="DECLpoint_G1_CL1"
                 toField="set_fraction"
                 toNode="DECLpoint_G1_PI1"/>
         <ROUTE fromField="keyValue"
                 fromNode="DECLpoint_G1_MB1"
                 toField="keyValue"
                 toNode="DECLpoint_G1_PI1"/>
         <ROUTE fromField="value_changed"
                 fromNode="DECLpoint_G1_PI1"
                 toField="set_translation"
                 toNode="DECLpoint_G1_node"/>
      </Transform>
      <Transform DEF="DECLpoint_G2_node">
         <Shape>
            <Sphere containerField="geometry" radius="0.1"/>
            <Appearance>
               <Material diffuseColor="1 0 0"/>
            </Appearance>
         </Shape>
         <PositionInterpolator DEF="DECLpoint_G2_PI1" key="0 1" keyValue="0 0 0 0 5 0"/>
         <Script DEF="DECLpoint_G2_MB1">
            <field accessType="inputOutput"
                    name="translation"
                    type="SFVec3f"
                    value="0 0 0"/>
            <field accessType="inputOutput"
                    name="old"
                    type="SFVec3f"
                    value="0 0 0"/>
            <field accessType="inputOnly" name="set_location" type="SFTime"/>
            <field accessType="inputOutput"
                    name="keyValue"
                    type="MFVec3f"
                    value="0 0 0 0 5 0"/>""&#xD;
"ecmascript:"&#xD;
"\t\tfunction set_location(value) {"&#xD;
"                    old = translation;"&#xD;
"\t\t    translation = new SFVec3f(Math.random()*10-5, Math.random()*10-5, Math.random()*10-5);"&#xD;
"                    keyValue = new MFVec3f([old, translation]);"&#xD;
"\t\t    // Browser.println(keyValue);"&#xD;
"\t\t}"&#xD;
""</Script>
         <TimeSensor DEF="DECLpoint_G2_CL1" cycleInterval="3" loop="true"/>
         <ROUTE fromField="cycleTime"
                 fromNode="DECLpoint_G2_CL1"
                 toField="set_location"
                 toNode="DECLpoint_G2_MB1"/>
         <ROUTE fromField="fraction_changed"
                 fromNode="DECLpoint_G2_CL1"
                 toField="set_fraction"
                 toNode="DECLpoint_G2_PI1"/>
         <ROUTE fromField="keyValue"
                 fromNode="DECLpoint_G2_MB1"
                 toField="keyValue"
                 toNode="DECLpoint_G2_PI1"/>
         <ROUTE fromField="value_changed"
                 fromNode="DECLpoint_G2_PI1"
                 toField="set_translation"
                 toNode="DECLpoint_G2_node"/>
      </Transform>
      <Group>
         <Transform DEF="DECLx3dconnector_connector1_trans">
            <Transform DEF="DECLx3dconnector_connector1_rotscale">
               <Shape>
                  <Appearance>
                     <Material diffuseColor="0.2 0.7 0.7" transparency="0.5"/>
                  </Appearance>
                  <Cylinder containerField="geometry" radius="0.05"/>
               </Shape>
            </Transform>
         </Transform>
         <Script DEF="DECLx3dconnector_connector1_S1">
            <field accessType="initializeOnly" name="startnode" type="SFNode">
               <Group USE="DECLpoint_G1_node"/>
            </field>
            <field accessType="initializeOnly" name="endnode" type="SFNode">
               <Group USE="DECLpoint_G2_node"/>
            </field>
            <field accessType="inputOutput" name="position" type="SFNode">
               <Transform USE="DECLx3dconnector_connector1_trans"/>
            </field>
            <field accessType="inputOutput" name="rotscale" type="SFNode">
               <Transform USE="DECLx3dconnector_connector1_rotscale"/>
            </field>
            <field accessType="inputOnly" name="set_startpoint" type="SFVec3f"/>
            <field accessType="inputOnly" name="set_endpoint" type="SFVec3f"/>""&#xD;
"ecmascript:"&#xD;
"        function recompute(startpoint,endpoint){"&#xD;
"\t    if (typeof endpoint === 'undefined') {"&#xD;
"\t\treturn;"&#xD;
"\t    }"&#xD;
"            var dif = endpoint.subtract(startpoint);"&#xD;
"            var dist = dif.length()*0.5;"&#xD;
"            var dif2 = dif.multiply(0.5);"&#xD;
"            var norm = dif.normalize();"&#xD;
"            var transl = startpoint.add(dif2);"&#xD;
"\t    if (typeof Quaternion !== 'undefined') {"&#xD;
"\t\t    return {"&#xD;
"\t\t\t    scale : new SFVec3f(1.0,dist,1.0),"&#xD;
"\t\t\t    translation : transl,"&#xD;
"\t\t\t    rotation : new Quaternion.rotateFromTo(new SFVec3f(0.0,1.0,0.0), norm)"&#xD;
"\t\t    };"&#xD;
"\t    } else if (typeof SFRotation !== 'undefined') {"&#xD;
"\t\t    return {"&#xD;
"\t\t\t    scale : new SFVec3f(1.0,dist,1.0),"&#xD;
"\t\t\t    translation : transl,"&#xD;
"\t\t\t    rotation : new SFRotation(new SFVec3f(0.0,1.0,0.0),norm)"&#xD;
"\t\t    };"&#xD;
"\t    } else {"&#xD;
"\t\t    return {"&#xD;
"\t\t\t    scale : new SFVec3f(1.0,dist,1.0),"&#xD;
"\t\t\t    translation : transl"&#xD;
"\t\t    };"&#xD;
"\t    }"&#xD;
"\t}"&#xD;
"\tfunction recompute_and_route(startpoint, endpoint) {"&#xD;
"\t      var trafo = recompute(startpoint, endpoint);"&#xD;
"\t      if (trafo) {"&#xD;
"\t\t      position.translation = trafo.translation;"&#xD;
"\t\t      rotscale.rotation = trafo.rotation;"&#xD;
"\t\t      rotscale.scale = trafo.scale;"&#xD;
"\t      }"&#xD;
"\t}"&#xD;
"        function initialize(){"&#xD;
"            recompute_and_route(startnode.translation,endnode.translation);"&#xD;
"        }"&#xD;
"        function set_startpoint(val,t){"&#xD;
"            recompute_and_route(val,endnode.translation);"&#xD;
"        }"&#xD;
"        function set_endpoint(val,t){"&#xD;
"            recompute_and_route(startnode.translation,val);"&#xD;
"        }"&#xD;
""</Script>
      </Group>
      <ROUTE fromField="translation"
              fromNode="DECLpoint_G1_node"
              toField="set_startpoint"
              toNode="DECLx3dconnector_connector1_S1"/>
      <ROUTE fromField="translation"
              fromNode="DECLpoint_G2_node"
              toField="set_endpoint"
              toNode="DECLx3dconnector_connector1_S1"/>
   </Scene>
</X3D>
