<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE X3D
  PUBLIC "ISO//Web3D//DTD X3D 3.3//EN" "https://www.web3d.org/specifications/x3d-3.3.dtd">
<X3D xmlns:xsd="http://www.w3.org/2001/XMLSchema-instance"
      profile="Immersive"
      version="3.3"
      xsd:noNamespaceSchemaLocation="https://www.web3d.org/specifications/x3d-3.3.xsd">
   <head>
      <meta content="bubble.x3d" name="title"/>
      <meta content="John Carlson" name="creator"/>
      <meta content="Tour around a prismatic sphere" name="description"/>
      <meta content="X3D-Edit, https://savage.nps.edu/X3D-Edit" name="generator"/>
      <meta content="https://coderextreme.net/X3DJSONLD/src/main/data/bubble.x3d"
             name="identifier"/>
   </head>
   <Scene>
      <NavigationInfo type="&#34;EXAMINE&#34;"/>
      <Viewpoint description="Bubble in action"
                  orientation="1 0 0 0"
                  position="0 0 4"/>
      <ProtoDeclare name="Bubble">
         <ProtoBody>
            <Transform DEF="transform">
               <Shape>
                  <Sphere containerField="geometry" radius="0.25"/>
                  <Appearance>
                     <Material diffuseColor="1 0 0" transparency="0.2"/>
                  </Appearance>
               </Shape>
               <Script DEF="bounce">
                  <field accessType="inputOutput"
                          name="scale"
                          type="SFVec3f"
                          value="1 1 1"/>
                  <field accessType="inputOutput"
                          name="translation"
                          type="SFVec3f"
                          value="0 0 0"/>
                  <field accessType="inputOutput"
                          name="velocity"
                          type="SFVec3f"
                          value="0 0 0"/>
                  <field accessType="inputOutput"
                          name="scalvel"
                          type="SFVec3f"
                          value="0 0 0"/>
                  <field accessType="inputOnly" name="set_fraction" type="SFFloat"/>""&#xD;
"ecmascript:"&#xD;
"function initialize() {"&#xD;
"    velocity = new SFVec3f(Math.random() * 0.25 - 0.125, Math.random() * 0.25 - 0.125, Math.random() * 0.25 - 0.125);"&#xD;
""&#xD;
"    scalvel = new SFVec3f(Math.random() * 0.4, Math.random() * 0.4, Math.random() * 0.4);"&#xD;
"}"&#xD;
""&#xD;
"function set_fraction(value) {"&#xD;
"\ttranslation = new SFVec3f("&#xD;
"\t\ttranslation.x + velocity.x,"&#xD;
"\t\ttranslation.y + velocity.y,"&#xD;
"\t\ttranslation.z + velocity.z);"&#xD;
"\tscale = new SFVec3f("&#xD;
"\t\tscale.x + scalvel.x,"&#xD;
"\t\tscale.y + scalvel.y,"&#xD;
"\t\tscale.z + scalvel.z);"&#xD;
"        // if you get to far away or too big, explode"&#xD;
"        if ( Math.abs(translation.x) &gt; 256) {"&#xD;
"\t\ttranslation.x = 0;"&#xD;
"\t\tinitialize();"&#xD;
"\t}"&#xD;
"        if ( Math.abs(translation.y) &gt; 256) {"&#xD;
"\t\ttranslation.y = 0;"&#xD;
"\t\tinitialize();"&#xD;
"\t}"&#xD;
"        if ( Math.abs(translation.z) &gt; 256) {"&#xD;
"\t\ttranslation.z = 0;"&#xD;
"\t\tinitialize();"&#xD;
"\t}"&#xD;
"\tif (Math.abs(scale.x) &gt; 20) {"&#xD;
"\t\tscale.x = scale.x/2;"&#xD;
"\t\ttranslation.x = 0;"&#xD;
"\t\tinitialize();"&#xD;
"\t}"&#xD;
"\tif (Math.abs(scale.y) &gt; 20) {"&#xD;
"\t\tscale.y = scale.y/2;"&#xD;
"\t\ttranslation.y = 0;"&#xD;
"\t\tinitialize();"&#xD;
"\t}"&#xD;
"\tif (Math.abs(scale.z) &gt; 20) {"&#xD;
"\t\tscale.z = scale.z/2;"&#xD;
"\t\ttranslation.z = 0;"&#xD;
"\t\tinitialize();"&#xD;
"\t}"&#xD;
"}"&#xD;
""</Script>
               <TimeSensor DEF="bubbleClock" cycleInterval="10" loop="true"/>
               <ROUTE fromField="translation_changed"
                       fromNode="bounce"
                       toField="set_translation"
                       toNode="transform"/>
               <ROUTE fromField="scale_changed"
                       fromNode="bounce"
                       toField="set_scale"
                       toNode="transform"/>
               <ROUTE fromField="fraction_changed"
                       fromNode="bubbleClock"
                       toField="set_fraction"
                       toNode="bounce"/>
            </Transform>
         </ProtoBody>
      </ProtoDeclare>
      <ProtoInstance DEF="bubbleA" name="Bubble"/>
   </Scene>
</X3D>
