<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE X3D
  PUBLIC "ISO//Web3D//DTD X3D 3.3//EN" "https://www.web3d.org/specifications/x3d-3.3.dtd">
<X3D xmlns:xsd="http://www.w3.org/2001/XMLSchema-instance"
      profile="Immersive"
      version="3.3"
      xsd:noNamespaceSchemaLocation="https://www.web3d.org/specifications/x3d-3.3.xsd">
   <head>
      <component level="1" name="Scripting"/>
      <meta content="bubs2.x3d" name="title"/>
      <meta content="John Carlson" name="creator"/>
      <meta content="Tour around a prismatic sphere" name="description"/>
      <meta content="X3D-Edit, https://savage.nps.edu/X3D-Edit" name="generator"/>
      <meta content="https://coderextreme.net/X3DJSONLD/src/main/data/geo.x3d"
             name="identifier"/>
      <meta content="13 March 2016" name="translated"/>
      <meta content="X3dToJson.xslt, https://www.web3d.org/x3d/stylesheets/X3dToJson.html"
             name="generator"/>
   </head>
   <Scene>
      <NavigationInfo type="&#34;EXAMINE&#34;"/>
      <Viewpoint description="Bubbles in action"
                  orientation="1 0 0 0"
                  position="0 0 4"/>
      <Background backUrl="&#34;../resources/images/BK.png&#34; &#34;https://coderextreme.net/X3DJSONLD/src/main/resources/images/BK.png&#34;"
                   bottomUrl="&#34;../resources/images/BT.png&#34; &#34;https://coderextreme.net/X3DJSONLD/src/main/resources/images/BT.png&#34;"
                   frontUrl="&#34;../resources/images/FR.png&#34; &#34;https://coderextreme.net/X3DJSONLD/src/main/resources/images/FR.png&#34;"
                   leftUrl="&#34;../resources/images/LF.png&#34; &#34;https://coderextreme.net/X3DJSONLD/src/main/resources/images/LF.png&#34;"
                   rightUrl="&#34;../resources/images/RT.png&#34; &#34;https://coderextreme.net/X3DJSONLD/src/main/resources/images/RT.png&#34;"
                   topUrl="&#34;../resources/images/TP.png&#34; &#34;https://coderextreme.net/X3DJSONLD/src/main/resources/images/TP.png&#34;"/>
      <ProtoDeclare name="Bubble">
         <ProtoBody>
            <Transform DEF="body_trans">
               <Shape>
                  <Sphere containerField="geometry" radius="0.25"/>
                  <Appearance>
                     <Material diffuseColor="1 0 0" transparency="0.2"/>
                  </Appearance>
               </Shape>
               <Script DEF="bounce">
                  <field accessType="inputOutput"
                          name="scale"
                          type="SFVec3f"
                          value="1 1 1"/>
                  <field accessType="inputOutput"
                          name="translation"
                          type="SFVec3f"
                          value="0 0 0"/>
                  <field accessType="inputOutput"
                          name="velocity"
                          type="SFVec3f"
                          value="0 0 0"/>
                  <field accessType="inputOutput"
                          name="scalvel"
                          type="SFVec3f"
                          value="0 0 0"/>
                  <field accessType="inputOnly" name="set_fraction" type="SFFloat"/>""&#xD;
"ecmascript:"&#xD;
"function initialize() {"&#xD;
"    velocity = new SFVec3f(Math.random() * 0.25 - 0.125, Math.random() * 0.25 - 0.125, Math.random() * 0.25 - 0.125);"&#xD;
""&#xD;
"    scalvel = new SFVec3f(Math.random() * 0.4, Math.random() * 0.4, Math.random() * 0.4);"&#xD;
"}"&#xD;
""&#xD;
"function set_fraction(value) {"&#xD;
"    if (typeof translation === 'undefined') {"&#xD;
"\t\ttranslation = new SFVec3f(0, 0, 0);"&#xD;
"    }"&#xD;
"    if (typeof velocity === 'undefined') {"&#xD;
"\t\tvelocity = new SFVec3f(0, 0, 0);"&#xD;
"    }"&#xD;
"    if (typeof scalvel === 'undefined') {"&#xD;
"\t\tscalvel = new SFVec3f(0, 0, 0);"&#xD;
"    }"&#xD;
"    if (typeof scale === 'undefined') {"&#xD;
"\t\tscale = new SFVec3f(1, 1, 1);"&#xD;
"    }"&#xD;
"    translation = new SFVec3f(\ttranslation.x + velocity.x, translation.y + velocity.y, translation.z + velocity.z);"&#xD;
"    scale = new SFVec3f(scale.x + scalvel.x, scale.y + scalvel.y, scale.z + scalvel.z);"&#xD;
"    // if you get to far away or too big, explode"&#xD;
"    if ( Math.abs(translation.x) &gt; 256) {"&#xD;
"\ttranslation.x = 0;"&#xD;
"\tinitialize();"&#xD;
"    }"&#xD;
"    if ( Math.abs(translation.y) &gt; 256) {"&#xD;
"\ttranslation.y = 0;"&#xD;
"\tinitialize();"&#xD;
"    }"&#xD;
"    if ( Math.abs(translation.z) &gt; 256) {"&#xD;
"\ttranslation.z = 0;"&#xD;
"\tinitialize();"&#xD;
"    }"&#xD;
"    if (Math.abs(scale.x) &gt; 20) {"&#xD;
"\tscale.x = scale.x/20;"&#xD;
"\ttranslation.x = 0;"&#xD;
"\tinitialize();"&#xD;
"    }"&#xD;
"    if (Math.abs(scale.y) &gt; 20) {"&#xD;
"\tscale.y = scale.y/20;"&#xD;
"\ttranslation.y = 0;"&#xD;
"\tinitialize();"&#xD;
"    }"&#xD;
"    if (Math.abs(scale.z) &gt; 20) {"&#xD;
"\tscale.z = scale.z/20;"&#xD;
"\ttranslation.z = 0;"&#xD;
"\tinitialize();"&#xD;
"    }"&#xD;
"}"</Script>
               <TimeSensor DEF="bubbleClock" cycleInterval="10" loop="true"/>
               <ROUTE fromField="translation_changed"
                       fromNode="bounce"
                       toField="set_translation"
                       toNode="body_trans"/>
               <ROUTE fromField="scale_changed"
                       fromNode="bounce"
                       toField="set_scale"
                       toNode="body_trans"/>
               <ROUTE fromField="fraction_changed"
                       fromNode="bubbleClock"
                       toField="set_fraction"
                       toNode="bounce"/>
            </Transform>
         </ProtoBody>
      </ProtoDeclare>
      <ProtoInstance DEF="bubbleA" name="Bubble"/>
      <ProtoInstance DEF="bubbleB" name="Bubble"/>
      <ProtoInstance DEF="bubbleC" name="Bubble"/>
      <ProtoInstance DEF="bubbleD" name="Bubble"/>
   </Scene>
</X3D>
