<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE X3D
  PUBLIC "ISO//Web3D//DTD X3D 3.0//EN" "https://www.web3d.org/specifications/x3d-3.0.dtd">
<X3D xmlns:xsd="http://www.w3.org/2001/XMLSchema-instance"
      profile="Immersive"
      version="3.0"
      xsd:noNamespaceSchemaLocation="https://www.web3d.org/specifications/x3d-3.0.xsd">
   <head>
      <component level="1" name="Scripting"/>
      <meta content="flowers2.x3d" name="title"/>
      <meta content="John Carlson" name="creator"/>
      <meta content="John Carlson" name="transcriber"/>
      <meta content="23 January 2005" name="created"/>
      <meta content="21 March 2018" name="modified"/>
      <meta content="2 random mathematical roses in spherical dimensions. rho = a + b * cos(c * theta) * cos(d * phi)"
             name="description"/>
      <meta content="https://coderextreme.net/X3DJSONLD/src/main/data/flowers2.x3d"
             name="identifier"/>
      <meta content="manually written" name="generator"/>
      <meta content="https://www.web3d.org/x3d/content/examples/license.html"
             name="license"/>
   </head>
   <Scene>
      <NavigationInfo/>
      <Viewpoint description="Two mathematical orbitals" position="0 0 50"/>
      <Group>
         <DirectionalLight direction="1 1 1"/>
         <ProtoDeclare name="orbit">
            <ProtoInterface>
               <field accessType="inputOutput"
                       name="translation"
                       type="SFVec3f"
                       value="-8 0 0"/>
               <field accessType="inputOutput"
                       name="diffuseColor"
                       type="SFColor"
                       value="1 0.5 0"/>
               <field accessType="inputOutput"
                       name="specularColor"
                       type="SFColor"
                       value="1 0.5 0"/>
               <field accessType="inputOutput"
                       name="transparency"
                       type="SFFloat"
                       value="0.75"/>
            </ProtoInterface>
            <ProtoBody>
               <Group>
                  <TimeSensor DEF="Clock" cycleInterval="16" loop="true"/>
                  <OrientationInterpolator DEF="OrbitPath"
                                            key="0.0 0.50 1.0"
                                            keyValue="1.0 0.0 0.0 0.0 1.0 0.0 0.0 3.14 1.0 0.0 0.0 6.28"/>
                  <Transform DEF="OrbitTransform">
                     <IS>
                        <connect nodeField="translation" protoField="translation"/>
                     </IS>
                     <Shape>
                        <Appearance>
                           <Material>
                              <IS>
                                 <connect nodeField="diffuseColor" protoField="diffuseColor"/>
                                 <connect nodeField="specularColor" protoField="specularColor"/>
                                 <connect nodeField="transparency" protoField="transparency"/>
                              </IS>
                           </Material>
                        </Appearance>
                        <!--"<IndexedFaceSet DEF="Orbit" creaseAngle="0"> <Coordinate DEF="OrbitCoordinates"/> </IndexedFaceSet>"-->
                        <IndexedFaceSet DEF="Orbit"
                                         ccw="false"
                                         containerField="geometry"
                                         convex="false"
                                         coordIndex="0 1 2 -1">
                           <Coordinate DEF="OrbitCoordinates" point="0 0 1 0 1 0 1 0 0"/>
                        </IndexedFaceSet>
                     </Shape>
                  </Transform>
                  <Script DEF="OrbitScript">
                     <field accessType="inputOnly" name="set_fraction" type="SFFloat"/>
                     <field accessType="outputOnly" name="coordinates" type="MFVec3f"/>
                     <field accessType="outputOnly" name="coordIndexes" type="MFInt32"/>
                     <field accessType="inputOutput" name="e" type="SFFloat" value="5"/>
                     <field accessType="inputOutput" name="f" type="SFFloat" value="5"/>
                     <field accessType="inputOutput" name="g" type="SFFloat" value="5"/>
                     <field accessType="inputOutput" name="h" type="SFFloat" value="5"/>
                     <field accessType="inputOutput"
                             name="resolution"
                             type="SFInt32"
                             value="50"/>""&#xD;
"\t\t\t"&#xD;
"\t\t\tecmascript:"&#xD;
""&#xD;
"\t\t\tvar e = 5;"&#xD;
"\t\t\tvar f = 5;"&#xD;
"\t\t\tvar g = 5;"&#xD;
"\t\t\tvar h = 5;"&#xD;
"\t\t\tvar resolution = 100;"&#xD;
""&#xD;
"\t\t\tfunction initialize() {"&#xD;
"\t\t\t     generateCoordinates();"&#xD;
"\t\t\t     var localci = [];"&#xD;
"\t\t\t     for (var i = 0; i &lt; resolution-1; i++) {"&#xD;
"\t\t\t\tfor (var j = 0; j &lt; resolution-1; j++) {"&#xD;
"\t\t\t\t     localci.push(i*resolution+j);"&#xD;
"\t\t\t\t     localci.push(i*resolution+j+1);"&#xD;
"\t\t\t\t     localci.push((i+1)*resolution+j+1);"&#xD;
"\t\t\t\t     localci.push((i+1)*resolution+j);"&#xD;
"\t\t\t\t     localci.push(-1);"&#xD;
"\t\t\t\t}"&#xD;
"\t\t\t    }"&#xD;
"\t\t\t    coordIndexes = new MFInt32(localci);"&#xD;
"\t\t\t}"&#xD;
""&#xD;
"\t\t\tfunction generateCoordinates() {"&#xD;
"\t\t\t     var theta = 0.0;"&#xD;
"\t\t\t     var phi = 0.0;"&#xD;
"\t\t\t     var delta = (2 * 3.141592653) / (resolution-1);"&#xD;
"\t\t\t     var localc = [];"&#xD;
"\t\t\t     for (var i = 0; i &lt; resolution; i++) {"&#xD;
"\t\t\t\tfor (var j = 0; j &lt; resolution; j++) {"&#xD;
"\t\t\t\t\tvar rho = e + f * Math.cos(g * theta) * Math.cos(h * phi);"&#xD;
"\t\t\t\t\tlocalc.push(new SFVec3f("&#xD;
"\t\t\t\t\t\trho * Math.cos(phi) * Math.cos(theta),"&#xD;
"\t\t\t\t\t\trho * Math.cos(phi) * Math.sin(theta),"&#xD;
"\t\t\t\t\t\trho * Math.sin(phi)"&#xD;
"\t\t\t\t\t));"&#xD;
"\t\t\t\t\ttheta += delta;"&#xD;
"\t\t\t\t}"&#xD;
"\t\t\t\tphi += delta;"&#xD;
"\t\t\t     }"&#xD;
"\t\t\t     "&#xD;
"\t\t\t     coordinates = new MFVec3f(localc);"&#xD;
"\t\t\t}"&#xD;
""&#xD;
"\t\t\tfunction set_fraction(fraction, eventTime) {"&#xD;
"\t\t\t\tvar choice = Math.floor(Math.random() * 4);"&#xD;
"\t\t\t\tswitch (choice) {"&#xD;
"\t\t\t\tcase 0:"&#xD;
"\t\t\t\t\te += Math.floor(Math.random() * 2) * 2 - 1;"&#xD;
"\t\t\t\t\tbreak;"&#xD;
"\t\t\t\tcase 1:"&#xD;
"\t\t\t\t\tf += Math.floor(Math.random() * 2) * 2 - 1;"&#xD;
"\t\t\t\t\tbreak;"&#xD;
"\t\t\t\tcase 2:"&#xD;
"\t\t\t\t\tg += Math.floor(Math.random() * 2) * 2 - 1;"&#xD;
"\t\t\t\t\tbreak;"&#xD;
"\t\t\t\tcase 3:"&#xD;
"\t\t\t\t\th += Math.floor(Math.random() * 2) * 2 - 1;"&#xD;
"\t\t\t\t\tbreak;"&#xD;
"\t\t\t\t}"&#xD;
"\t\t\t\tif (e &lt; 1) {"&#xD;
"\t\t\t\t\tf = 10;"&#xD;
"\t\t\t\t}"&#xD;
"\t\t\t\tif (f &lt; 1) {"&#xD;
"\t\t\t\t\tf = 10;"&#xD;
"\t\t\t\t}"&#xD;
"\t\t\t\tif (g &lt; 1) {"&#xD;
"\t\t\t\t\tg = 4;"&#xD;
"\t\t\t\t}"&#xD;
"\t\t\t\tif (h &lt; 1) {"&#xD;
"\t\t\t\t\th = 4;"&#xD;
"\t\t\t\t}"&#xD;
"\t\t\t\tgenerateCoordinates();"&#xD;
"\t\t\t}"&#xD;
"\t\t\t      "</Script>
                  <ROUTE fromField="coordIndexes"
                          fromNode="OrbitScript"
                          toField="set_coordIndex"
                          toNode="Orbit"/>
                  <ROUTE fromField="coordinates"
                          fromNode="OrbitScript"
                          toField="point"
                          toNode="OrbitCoordinates"/>
                  <ROUTE fromField="fraction_changed"
                          fromNode="Clock"
                          toField="set_fraction"
                          toNode="OrbitScript"/>
                  <ROUTE fromField="value_changed"
                          fromNode="OrbitPath"
                          toField="rotation"
                          toNode="OrbitTransform"/>
                  <ROUTE fromField="fraction_changed"
                          fromNode="Clock"
                          toField="set_fraction"
                          toNode="OrbitPath"/>
               </Group>
            </ProtoBody>
         </ProtoDeclare>
         <ProtoInstance name="orbit">
            <fieldValue name="translation" value="-8 0 0"/>
            <fieldValue name="diffuseColor" value="1 0.5 0"/>
            <fieldValue name="specularColor" value="1 0.5 0"/>
            <fieldValue name="transparency" value="0.75"/>
         </ProtoInstance>
         <ProtoInstance name="orbit">
            <fieldValue name="translation" value="8 0 0"/>
            <fieldValue name="diffuseColor" value="0 0.5 1"/>
            <fieldValue name="specularColor" value="0 0.5 1"/>
            <fieldValue name="transparency" value="0.5"/>
         </ProtoInstance>
      </Group>
   </Scene>
</X3D>
