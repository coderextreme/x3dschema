<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE X3D PUBLIC "ISO//Web3D//DTD X3D 4.0//EN" "http://www.web3d.org/specifications/x3d-4.0.dtd">

<X3D profile="Immersive" version="4.0"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema-instance" xsd:noNamespaceSchemaLocation="https://www.web3d.org/specifications/x3d-4.0.xsd">
    <head>
        <component level="1" name="Scripting"/>
        <component level="3" name="EnvironmentalEffects"/>
        <component level="1" name="Shaders"/>
        <component level="1" name="CubeMapTexturing"/>
        <component level="1" name="Texturing"/>
        <component level="1" name="Rendering"/>
        <component level="4" name="Shape"/>
        <component level="3" name="Grouping"/>
        <component level="1" name="Core"/>
        <meta content="flowers.x3d" name="title"/>
        <meta content="John Carlson" name="creator"/>
        <meta content="5 or more prismatic flowers" name="description"/>
        <meta content="X3D-Edit, https://savage.nps.edu/X3D-Edit" name="generator"/>
        <meta
            content="https://coderextreme.net/X3DJSONLD/src/main/data/flowers.x3d" name="identifier"/>
    </head>
    <Scene>
        <NavigationInfo/>
        <!--"Images courtesy of Paul Debevec's Light Probe Image Gallery"-->
        <Background
            backUrl="&quot;../resources/images/all_probes/stpeters_cross/stpeters_back.png&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/resources/images/all_probes/stpeters_cross/stpeters_back.png&quot;"
            bottomUrl="&quot;../resources/images/all_probes/stpeters_cross/stpeters_bottom.png&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/resources/images/all_probes/stpeters_cross/stpeters_bottom.png&quot;"
            frontUrl="&quot;../resources/images/all_probes/stpeters_cross/stpeters_front.png&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/resources/images/all_probes/stpeters_cross/stpeters_front.png&quot;"
            leftUrl="&quot;../resources/images/all_probes/stpeters_cross/stpeters_left.png&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/resources/images/all_probes/stpeters_cross/stpeters_left.png&quot;"
            rightUrl="&quot;../resources/images/all_probes/stpeters_cross/stpeters_right.png&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/resources/images/all_probes/stpeters_cross/stpeters_right.png&quot;" topUrl="&quot;../resources/images/all_probes/stpeters_cross/stpeters_top.png&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/resources/images/all_probes/stpeters_cross/stpeters_top.png&quot;"/>
        <ProtoDeclare name="flower">
            <ProtoBody>
                <Transform DEF="animate_transform">
                    <Shape>
                        <Appearance>
                            <Material diffuseColor="0.7 0.7 0.7" specularColor="0.5 0.5 0.5"/>
                            <ComposedCubeMapTexture DEF="texture">
                                <ImageTexture containerField="back" url="&quot;../resources/images/all_probes/stpeters_cross/stpeters_back.png&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/resources/images/all_probes/stpeters_cross/stpeters_back.png&quot;"/>
                                <ImageTexture containerField="bottom" url="&quot;../resources/images/all_probes/stpeters_cross/stpeters_bottom.png&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/resources/images/all_probes/stpeters_cross/stpeters_bottom.png&quot;"/>
                                <ImageTexture containerField="front" url="&quot;../resources/images/all_probes/stpeters_cross/stpeters_front.png&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/resources/images/all_probes/stpeters_cross/stpeters_front.png&quot;"/>
                                <ImageTexture containerField="left" url="&quot;../resources/images/all_probes/stpeters_cross/stpeters_left.png&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/resources/images/all_probes/stpeters_cross/stpeters_left.png&quot;"/>
                                <ImageTexture containerField="right" url="&quot;../resources/images/all_probes/stpeters_cross/stpeters_right.png&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/resources/images/all_probes/stpeters_cross/stpeters_right.png&quot;"/>
                                <ImageTexture containerField="top" url="&quot;../resources/images/all_probes/stpeters_cross/stpeters_top.png&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/resources/images/all_probes/stpeters_cross/stpeters_top.png&quot;"/>
                            </ComposedCubeMapTexture>
                            <ComposedShader DEF="x3dom" language="GLSL">
                                <field accessType="inputOutput"
                                    name="cube" type="SFInt32" value="0"/>
                                <field accessType="initializeOnly"
                                    name="chromaticDispertion"
                                    type="SFVec3f" value="0.98 1.0 1.033"/>
                                <field accessType="inputOutput"
                                    name="bias" type="SFFloat" value="0.5"/>
                                <field accessType="inputOutput"
                                    name="scale" type="SFFloat" value="0.5"/>
                                <field accessType="inputOutput"
                                    name="power" type="SFFloat" value="2"/>
                                <field accessType="inputOutput" name="a"
                                    type="SFFloat" value="10"/>
                                <field accessType="inputOutput" name="b"
                                    type="SFFloat" value="1"/>
                                <field accessType="inputOutput" name="c"
                                    type="SFFloat" value="20"/>
                                <field accessType="inputOutput" name="d"
                                    type="SFFloat" value="20"/>
                                <field accessType="inputOutput"
                                    name="tdelta" type="SFFloat" value="0"/>
                                <field accessType="inputOutput"
                                    name="pdelta" type="SFFloat" value="0"/>
                                <!--"<field name='cube' type='SFNode' accessType="inputOutput"> <ComposedCubeMapTexture USE="texture"/> </field>"-->
                                <ShaderPart type="VERTEX" url="&quot;../shaders/x3dom_flowers_chromatic.vs&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/shaders/x3dom_flowers_chromatic.vs&quot;"/>
                                <ShaderPart type="FRAGMENT" url="&quot;../shaders/common.fs&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/shaders/common.fs&quot;"/>
                            </ComposedShader>
                            <ComposedShader DEF="x_ite" language="GLSL">
                                <field accessType="inputOutput"
                                    name="cube" type="SFNode">
                                    <ComposedCubeMapTexture USE="texture"/>
                                </field>
                                <field accessType="initializeOnly"
                                    name="chromaticDispertion"
                                    type="SFVec3f" value="0.98 1.0 1.033"/>
                                <field accessType="inputOnly"
                                    name="bias" type="SFFloat" value="0.5"/>
                                <field accessType="inputOnly"
                                    name="scale" type="SFFloat" value="0.5"/>
                                <field accessType="inputOnly"
                                    name="power" type="SFFloat" value="2"/>
                                <field accessType="inputOnly" name="a"
                                    type="SFFloat" value="10"/>
                                <field accessType="inputOnly" name="b"
                                    type="SFFloat" value="1"/>
                                <field accessType="inputOnly" name="c"
                                    type="SFFloat" value="20"/>
                                <field accessType="inputOnly" name="d"
                                    type="SFFloat" value="20"/>
                                <field accessType="inputOnly"
                                    name="tdelta" type="SFFloat" value="0"/>
                                <field accessType="inputOnly"
                                    name="pdelta" type="SFFloat" value="0"/>
                                <ShaderPart type="VERTEX" url="&quot;../shaders/x_ite_flowers_chromatic.vs&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/shaders/x_ite_flowers_chromatic.vs&quot;"/>
                                <ShaderPart type="FRAGMENT" url="&quot;../shaders/x_ite.fs&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/shaders/x_ite.fs&quot;"/>
                            </ComposedShader>
                        </Appearance>
                        <Sphere/>
                    </Shape>
                </Transform>
                <Script DEF="Animate">
                    <field accessType="inputOutput" name="translation"
                        type="SFVec3f" value="0 0 0"/>
                    <field accessType="inputOutput" name="velocity"
                        type="SFVec3f" value="0 0 0"/>
                    <field accessType="inputOnly" name="set_fraction" type="SFFloat"/>
                    <field accessType="inputOutput" name="a"
                        type="SFFloat" value="0.5"/>
                    <field accessType="inputOutput" name="b"
                        type="SFFloat" value="0.5"/>
                    <field accessType="inputOutput" name="c"
                        type="SFFloat" value="3"/>
                    <field accessType="inputOutput" name="d"
                        type="SFFloat" value="3"/>
                    <field accessType="inputOutput" name="tdelta"
                        type="SFFloat" value="0.5"/>
                    <field accessType="inputOutput" name="pdelta"
                        type="SFFloat" value="0.5"/><![CDATA[""
""
"ecmascript:"
""
"\t\t\tfunction initialize() {"
"\t\t\t    translation = new SFVec3f(0, 0, 0);"
"\t\t\t    velocity = new SFVec3f("
"\t\t\t    \tMath.random() - 0.5,"
"\t\t\t\tMath.random() - 0.5,"
"\t\t\t\tMath.random() - 0.5);"
"\t\t\t}"
"\t\t\tfunction set_fraction() {"
"\t\t\t    translation = new SFVec3f("
"\t\t\t    \ttranslation.x + velocity.x,"
"\t\t\t\ttranslation.y + velocity.y,"
"\t\t\t\ttranslation.z + velocity.z);"
"\t\t\t    for (var j = 0; j <= 2; j++) {"
"\t\t\t\t    if (Math.abs(translation.x) > 10) {"
"\t\t\t\t\tinitialize();"
"\t\t\t\t    } else if (Math.abs(translation.y) > 10) {"
"\t\t\t\t\tinitialize();"
"\t\t\t\t    } else if (Math.abs(translation.z) > 10) {"
"\t\t\t\t\tinitialize();"
"\t\t\t\t    } else {"
"\t\t\t\t\tvelocity.x += Math.random() * 0.2 - 0.1;"
"\t\t\t\t\tvelocity.y += Math.random() * 0.2 - 0.1;"
"\t\t\t\t\tvelocity.z += Math.random() * 0.2 - 0.1;"
"\t\t\t\t    }"
"\t\t\t    }"
"\t\t\t    animate_flowers();"
"\t\t\t}"
""
"\t\t\tfunction animate_flowers(fraction, eventTime) {"
"\t\t\t\tvar choice = Math.floor(Math.random() * 4);"
"\t\t\t\tswitch (choice) {"
"\t\t\t\tcase 0:"
"\t\t\t\t\ta += Math.random() * 0.2 - 0.1;"
"\t\t\t\t\tbreak;"
"\t\t\t\tcase 1:"
"\t\t\t\t\tb += Math.random() * 0.2 - 0.1;"
"\t\t\t\t\tbreak;"
"\t\t\t\tcase 2:"
"\t\t\t\t\tc += Math.random() * 2 - 1;"
"\t\t\t\t\tbreak;"
"\t\t\t\tcase 3:"
"\t\t\t\t\td += Math.random() * 2 - 1;"
"\t\t\t\t\tbreak;"
"\t\t\t\t}"
"\t\t\t\ttdelta = tdelta + 0.5;"
"\t\t\t\tpdelta = pdelta + 0.5;"
"\t\t\t\tif (a > 1) {"
"\t\t\t\t\ta =  0.5;"
"\t\t\t\t}"
"\t\t\t\tif (b > 1) {"
"\t\t\t\t\tb =  0.5;"
"\t\t\t\t}"
"\t\t\t\tif (c < 1) {"
"\t\t\t\t\tc =  4;"
"\t\t\t\t}"
"\t\t\t\tif (d < 1) {"
"\t\t\t\t\td =  4;"
"\t\t\t\t}"
"\t\t\t\tif (c > 10) {"
"\t\t\t\t\tc = 4;"
"\t\t\t\t}"
"\t\t\t\tif (d > 10) {"
"\t\t\t\t\td = 4;"
"\t\t\t\t}"
"\t\t\t}"
""
""]]></Script>
                <TimeSensor DEF="TourTime" cycleInterval="5" loop="true"/>
                <ROUTE fromField="fraction_changed" fromNode="TourTime"
                    toField="set_fraction" toNode="Animate"/>
                <ROUTE fromField="translation_changed"
                    fromNode="Animate" toField="set_translation" toNode="animate_transform"/>
                <ROUTE fromField="a" fromNode="Animate" toField="a" toNode="x_ite"/>
                <ROUTE fromField="b" fromNode="Animate" toField="b" toNode="x_ite"/>
                <ROUTE fromField="c" fromNode="Animate" toField="c" toNode="x_ite"/>
                <ROUTE fromField="d" fromNode="Animate" toField="d" toNode="x_ite"/>
                <ROUTE fromField="pdelta" fromNode="Animate"
                    toField="pdelta" toNode="x_ite"/>
                <ROUTE fromField="tdelta" fromNode="Animate"
                    toField="tdelta" toNode="x_ite"/>
                <ROUTE fromField="a" fromNode="Animate" toField="a" toNode="x3dom"/>
                <ROUTE fromField="b" fromNode="Animate" toField="b" toNode="x3dom"/>
                <ROUTE fromField="c" fromNode="Animate" toField="c" toNode="x3dom"/>
                <ROUTE fromField="d" fromNode="Animate" toField="d" toNode="x3dom"/>
                <ROUTE fromField="pdelta" fromNode="Animate"
                    toField="pdelta" toNode="x3dom"/>
                <ROUTE fromField="tdelta" fromNode="Animate"
                    toField="tdelta" toNode="x3dom"/>
            </ProtoBody>
        </ProtoDeclare>
        <ProtoInstance name="flower"/>
        <ProtoInstance name="flower"/>
        <ProtoInstance name="flower"/>
    </Scene>
</X3D>
