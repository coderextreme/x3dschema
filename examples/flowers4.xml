<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE X3D PUBLIC "ISO//Web3D//DTD X3D 4.0//EN" "http://www.web3d.org/specifications/x3d-4.0.dtd">

<X3D profile="Immersive" version="4.0"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema-instance" xsd:noNamespaceSchemaLocation="https://www.web3d.org/specifications/x3d-4.0.xsd">
    <head>
        <component level="1" name="Scripting"/>
        <component level="3" name="EnvironmentalEffects"/>
        <component level="1" name="Shaders"/>
        <component level="1" name="CubeMapTexturing"/>
        <component level="1" name="Texturing"/>
        <component level="1" name="Rendering"/>
        <component level="4" name="Shape"/>
        <component level="3" name="Grouping"/>
        <component level="1" name="Core"/>
        <meta content="flowers4.x3d" name="title"/>
        <meta content="John Carlson" name="creator"/>
        <meta content="manual" name="generator"/>
        <meta
            content="https://coderextreme.net/X3DJSONLD/src/main/data/flowers4.x3d" name="identifier"/>
        <meta content="an animated flower" name="description"/>
    </head>
    <Scene>
        <NavigationInfo/>
        <Background
            backUrl="&quot;../resources/images/all_probes/stpeters_cross/stpeters_back.png&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/resources/images/all_probes/stpeters_cross/stpeters_back.png&quot;"
            bottomUrl="&quot;../resources/images/all_probes/stpeters_cross/stpeters_bottom.png&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/resources/images/all_probes/stpeters_cross/stpeters_bottom.png&quot;"
            frontUrl="&quot;../resources/images/all_probes/stpeters_cross/stpeters_front.png&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/resources/images/all_probes/stpeters_cross/stpeters_front.png&quot;"
            leftUrl="&quot;../resources/images/all_probes/stpeters_cross/stpeters_left.png&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/resources/images/all_probes/stpeters_cross/stpeters_left.png&quot;"
            rightUrl="&quot;../resources/images/all_probes/stpeters_cross/stpeters_right.png&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/resources/images/all_probes/stpeters_cross/stpeters_right.png&quot;" topUrl="&quot;../resources/images/all_probes/stpeters_cross/stpeters_top.png&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/resources/images/all_probes/stpeters_cross/stpeters_top.png&quot;"/>
        <Transform DEF="transform">
            <Shape>
                <Appearance>
                    <Material diffuseColor="0.7 0.7 0.7" specularColor="0.5 0.5 0.5"/>
                    <ComposedCubeMapTexture>
                        <ImageTexture containerField="back" url="&quot;../resources/images/all_probes/stpeters_cross/stpeters_back.png&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/resources/images/all_probes/stpeters_cross/stpeters_back.png&quot;"/>
                        <ImageTexture containerField="bottom" url="&quot;../resources/images/all_probes/stpeters_cross/stpeters_bottom.png&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/resources/images/all_probes/stpeters_cross/stpeters_bottom.png&quot;"/>
                        <ImageTexture containerField="front" url="&quot;../resources/images/all_probes/stpeters_cross/stpeters_front.png&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/resources/images/all_probes/stpeters_cross/stpeters_front.png&quot;"/>
                        <ImageTexture containerField="left" url="&quot;../resources/images/all_probes/stpeters_cross/stpeters_left.png&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/resources/images/all_probes/stpeters_cross/stpeters_left.png&quot;"/>
                        <ImageTexture containerField="right" url="&quot;../resources/images/all_probes/stpeters_cross/stpeters_right.png&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/resources/images/all_probes/stpeters_cross/stpeters_right.png&quot;"/>
                        <ImageTexture containerField="top" url="&quot;../resources/images/all_probes/stpeters_cross/stpeters_top.png&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/resources/images/all_probes/stpeters_cross/stpeters_top.png&quot;"/>
                    </ComposedCubeMapTexture>
                    <ComposedShader DEF="shader" language="GLSL">
                        <field accessType="inputOutput" name="cube"
                            type="SFInt32" value="0"/>
                        <field accessType="inputOutput"
                            name="chromaticDispertion" type="SFVec3f" value="0.98 1.0 1.033"/>
                        <field accessType="inputOutput" name="bias"
                            type="SFFloat" value="0.5"/>
                        <field accessType="inputOutput" name="scale"
                            type="SFFloat" value="0.5"/>
                        <field accessType="inputOutput" name="power"
                            type="SFFloat" value="2"/>
                        <ShaderPart type="VERTEX" url="&quot;../shaders/x3dom.vs&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/shaders/x3dom.vs&quot;"/>
                        <ShaderPart type="FRAGMENT" url="&quot;../shaders/pc_bubbles.fs&quot; &quot;https://coderextreme.net/X3DJSONLD/src/main/shaders/pc_bubbles.fs&quot;"/>
                    </ComposedShader>
                </Appearance>
                <!--"<Sphere>"-->
                <IndexedFaceSet DEF="Orbit" convex="false">
                    <Coordinate DEF="OrbitCoordinates"/>
                </IndexedFaceSet>
            </Shape>
        </Transform>
        <Script DEF="OrbitScript">
            <field accessType="inputOnly" name="set_fraction" type="SFFloat"/>
            <field accessType="inputOutput" name="coordinates" type="MFVec3f"/>
            <field accessType="outputOnly" name="coordIndexes" type="MFInt32"/><![CDATA[""
""
""
"ecmascript:"
""
"var e = 5;"
"var f = 5;"
"var g = 5;"
"var h = 5;"
""
"function initialize() {"
"     var resolution = 100;"
"     updateCoordinates(resolution);"
"     var cis = [];"
"     for ( i = 0; i < resolution-1; i++) {"
"     \tfor ( j = 0; j < resolution-1; j++) {"
"\t     cis.push(i*resolution+j);"
"\t     cis.push(i*resolution+j+1);"
"\t     cis.push((i+1)*resolution+j+1);"
"\t     cis.push((i+1)*resolution+j);"
"\t     cis.push(-1);"
"\t}"
"    }"
"    coordIndexes = new MFInt32(cis);"
"}"
""
"function updateCoordinates(resolution) {"
"     var theta = 0.0;"
"     var phi = 0.0;"
"     var delta = (2 * 3.141592653) / (resolution-1);"
"     var crds = [];"
"     for ( i = 0; i < resolution; i++) {"
"     \tfor ( j = 0; j < resolution; j++) {"
"\t\tvar rho = e + f * Math.cos(g * theta) * Math.cos(h * phi);"
"\t\tcrds.push(new SFVec3f("
"\t\t\trho * Math.cos(phi) * Math.cos(theta),"
"\t\t\trho * Math.cos(phi) * Math.sin(theta),"
"\t\t\trho * Math.sin(phi)"
"\t\t));"
"\t\ttheta += delta;"
"\t}"
"\tphi += delta;"
"     }"
"     coordinates = new MFVec3f(crds);"
"}"
""
"function set_fraction(fraction, eventTime) {"
"\tvar choice = Math.floor(Math.random() * 4);"
"\tswitch (choice) {"
"\tcase 0:"
"\t\te += Math.floor(Math.random() * 2) * 2 - 1;"
"\t\tbreak;"
"\tcase 1:"
"\t\tf += Math.floor(Math.random() * 2) * 2 - 1;"
"\t\tbreak;"
"\tcase 2:"
"\t\tg += Math.floor(Math.random() * 2) * 2 - 1;"
"\t\tbreak;"
"\tcase 3:"
"\t\th += Math.floor(Math.random() * 2) * 2 - 1;"
"\t\tbreak;"
"\t}"
"\tif (f < 1) {"
"\t\tf = 10;"
"\t}"
"\tif (g < 1) {"
"\t\tg = 4;"
"\t}"
"\tif (h < 1) {"
"\t\th = 4;"
"\t}"
"\tvar resolution = 100;"
"\tupdateCoordinates(resolution);"
"}"
""]]></Script>
        <TimeSensor DEF="Clock" cycleInterval="16" loop="true"/>
        <ROUTE fromField="coordIndexes" fromNode="OrbitScript"
            toField="set_coordIndex" toNode="Orbit"/>
        <ROUTE fromField="coordinates" fromNode="OrbitScript"
            toField="set_point" toNode="OrbitCoordinates"/>
        <ROUTE fromField="fraction_changed" fromNode="Clock"
            toField="set_fraction" toNode="OrbitScript"/>
    </Scene>
</X3D>
